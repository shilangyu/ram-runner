<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>RAM machine</title>
    <style>
      #code {
        box-sizing: border-box;
        width: 50%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <script type="module" defer>
      import init, { run_program } from "./out/ram_machine.js";

      const debounce = (callback, wait) => {
        let timeoutId = null;
        return (...args) => {
          window.clearTimeout(timeoutId);
          timeoutId = window.setTimeout(() => {
            callback.apply(null, args);
          }, wait);
        };
      };

      await init();

      const code = document.querySelector("#code");
      const out = document.querySelector("#out");

      const onChange = () => {
        try {
          const res = run_program(code.value, { RX: "10111" });

          out.innerText = res;
        } catch (err) {
          out.innerText = err;
        }
      };

      code.addEventListener("input", debounce(onChange, 1000));

      onChange();
    </script>

    <textarea id="code" width="100%">
N0: clr RY 
    clr RZ

N1: RX jmp0 N2
    RX jmp1 N3
    jmp NEND
	
N2: add0 RY
    del RX
    jmp N4

N3: add1 RY
    del RX
    jmp N4

N4: RZ jmp0 N5
    RZ jmp1 N6
    RZ <- RY
    clr RY
    jmp N1

N5: del RZ
    add0 RY
    jmp N4

N6: del RZ
    add1 RY
    jmp N4

NEND: RX <- RZ
      clr RY
      clr RZ
      continue
    </textarea>
    <div id="out"></div>
  </body>
</html>
